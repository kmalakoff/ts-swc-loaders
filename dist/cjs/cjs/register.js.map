{"version":3,"sources":["register.mjs"],"sourcesContent":["import path from 'path';\nimport pirates from 'pirates';\nimport '../polyfills.cjs';\n\nimport Cache from '../Cache.js';\nimport createMatcher from '../createMatcher.mjs';\nimport extensions from '../extensions.mjs';\nimport loadTSConfig from '../loadTSConfig.mjs';\nimport transformSync from '../transformSync.cjs';\n\nconst cache = new Cache();\nconst config = loadTSConfig(path.resolve(process.cwd(), 'tsconfig.json'));\nconfig.config.compilerOptions.module = 'CommonJS';\nconfig.config.compilerOptions.target = 'ES5';\nconst match = createMatcher(config);\n\nexport function register(options, hookOpts) {\n  options = options || {};\n  return pirates.addHook((code, filePath) => compile(code, filePath, options), Object.assign({ exts: extensions }, hookOpts || {}));\n}\n\nexport function compile(contents, filePath) {\n  // filter\n  if (!match(filePath)) return contents || ' ';\n  if (filePath.endsWith('.d.ts')) return ' ';\n  if (extensions.indexOf(path.extname(filePath)) < 0) return contents || ' ';\n\n  const data = cache.getOrUpdate(cache.cachePath(filePath, config), contents, () => transformSync(contents, filePath, config));\n  return data.code;\n}\n"],"names":["compile","register","cache","Cache","config","loadTSConfig","path","resolve","process","cwd","compilerOptions","module","target","match","createMatcher","options","hookOpts","pirates","addHook","code","filePath","Object","assign","exts","extensions","contents","endsWith","indexOf","extname","data","getOrUpdate","cachePath","transformSync"],"mappings":";;;;;;;;;;;IAqBgBA,OAAO;eAAPA;;IALAC,QAAQ;eAARA;;;2DAhBC;8DACG;QACb;4DAEW;oEACQ;iEACH;mEACE;uEACC;;;;;;AAE1B,IAAMC,QAAQ,IAAIC,cAAK;AACvB,IAAMC,SAASC,IAAAA,qBAAY,EAACC,aAAI,CAACC,OAAO,CAACC,QAAQC,GAAG,IAAI;AACxDL,OAAOA,MAAM,CAACM,eAAe,CAACC,MAAM,GAAG;AACvCP,OAAOA,MAAM,CAACM,eAAe,CAACE,MAAM,GAAG;AACvC,IAAMC,QAAQC,IAAAA,sBAAa,EAACV;AAErB,SAASH,SAASc,OAAO,EAAEC,QAAQ;IACxCD,UAAUA,WAAW,CAAC;IACtB,OAAOE,gBAAO,CAACC,OAAO,CAAC,SAACC,MAAMC;eAAapB,QAAQmB,MAAMC,UAAUL;OAAUM,OAAOC,MAAM,CAAC;QAAEC,MAAMC,mBAAU;IAAC,GAAGR,YAAY,CAAC;AAChI;AAEO,SAAShB,QAAQyB,QAAQ,EAAEL,QAAQ;IACxC,SAAS;IACT,IAAI,CAACP,MAAMO,WAAW,OAAOK,YAAY;IACzC,IAAIL,SAASM,QAAQ,CAAC,UAAU,OAAO;IACvC,IAAIF,mBAAU,CAACG,OAAO,CAACrB,aAAI,CAACsB,OAAO,CAACR,aAAa,GAAG,OAAOK,YAAY;IAEvE,IAAMI,OAAO3B,MAAM4B,WAAW,CAAC5B,MAAM6B,SAAS,CAACX,UAAUhB,SAASqB,UAAU;eAAMO,IAAAA,yBAAa,EAACP,UAAUL,UAAUhB;;IACpH,OAAOyB,KAAKV,IAAI;AAClB"}