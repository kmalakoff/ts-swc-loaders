{"version":3,"sources":["packageType.mjs"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport { URL, fileURLToPath, pathToFileURL } from 'url';\n\nconst packageJSONCache = new Map();\nfunction readPackageJson(path) {\n  const existing = packageJSONCache.get(path);\n  if (existing !== undefined) return existing;\n\n  try {\n    const packageJson = JSON.parse(fs.readFileSync(path, 'utf8'));\n    packageJSONCache.set(path, packageJson);\n    return packageJson;\n  } catch (_err) {\n    packageJSONCache.set(path, null);\n    return null;\n  }\n}\n\n// https://github.com/nodejs/node/blob/main/lib/internal/modules/esm/package_config.js#L103\nfunction getPackageScopeConfig(resolved) {\n  let packageJSONUrl = new URL('./package.json', resolved);\n  while (packageJSONUrl) {\n    const packageJSONPath = packageJSONUrl.pathname;\n    if (packageJSONPath.endsWith('node_modules/package.json')) {\n      break;\n    }\n    const packageConfig = readPackageJson(fileURLToPath(packageJSONUrl));\n    if (packageConfig) return packageConfig;\n\n    const lastPackageJSONUrl = packageJSONUrl;\n    packageJSONUrl = new URL('../package.json', packageJSONUrl);\n\n    // Terminates at root where ../package.json equals ../../package.json\n    // (can't just check \"/package.json\" for Windows support).\n    if (packageJSONUrl.pathname === lastPackageJSONUrl.pathname) break;\n  }\n  return {};\n}\n\nexport default function packageType(url) {\n  if (path.isAbsolute(url)) url = pathToFileURL(url); // windows\n\n  const pkg = getPackageScopeConfig(url);\n  return pkg.type || 'commonjs';\n}\n"],"names":["packageType","packageJSONCache","Map","readPackageJson","path","existing","get","undefined","packageJson","JSON","parse","fs","readFileSync","set","_err","getPackageScopeConfig","resolved","packageJSONUrl","URL","packageJSONPath","pathname","endsWith","packageConfig","fileURLToPath","lastPackageJSONUrl","url","isAbsolute","pathToFileURL","pkg","type"],"mappings":";;;;+BAwCA;;;eAAwBA;;;yDAxCT;2DACE;mBACiC;;;;;;AAElD,IAAMC,mBAAmB,IAAIC;AAC7B,SAASC,gBAAgBC,IAAI;IAC3B,IAAMC,WAAWJ,iBAAiBK,GAAG,CAACF;IACtC,IAAIC,aAAaE,WAAW,OAAOF;IAEnC,IAAI;QACF,IAAMG,cAAcC,KAAKC,KAAK,CAACC,WAAE,CAACC,YAAY,CAACR,MAAM;QACrDH,iBAAiBY,GAAG,CAACT,MAAMI;QAC3B,OAAOA;IACT,EAAE,OAAOM,MAAM;QACbb,iBAAiBY,GAAG,CAACT,MAAM;QAC3B,OAAO;IACT;AACF;AAEA,2FAA2F;AAC3F,SAASW,sBAAsBC,QAAQ;IACrC,IAAIC,iBAAiB,IAAIC,QAAG,CAAC,kBAAkBF;IAC/C,MAAOC,eAAgB;QACrB,IAAME,kBAAkBF,eAAeG,QAAQ;QAC/C,IAAID,gBAAgBE,QAAQ,CAAC,8BAA8B;YACzD;QACF;QACA,IAAMC,gBAAgBnB,gBAAgBoB,IAAAA,kBAAa,EAACN;QACpD,IAAIK,eAAe,OAAOA;QAE1B,IAAME,qBAAqBP;QAC3BA,iBAAiB,IAAIC,QAAG,CAAC,mBAAmBD;QAE5C,qEAAqE;QACrE,0DAA0D;QAC1D,IAAIA,eAAeG,QAAQ,KAAKI,mBAAmBJ,QAAQ,EAAE;IAC/D;IACA,OAAO,CAAC;AACV;AAEe,SAASpB,YAAYyB,GAAG;IACrC,IAAIrB,aAAI,CAACsB,UAAU,CAACD,MAAMA,MAAME,IAAAA,kBAAa,EAACF,MAAM,UAAU;IAE9D,IAAMG,MAAMb,sBAAsBU;IAClC,OAAOG,IAAIC,IAAI,IAAI;AACrB"}