{"version":3,"sources":["register.mjs"],"sourcesContent":["import path from 'path';\nimport pirates from 'pirates';\nimport '../polyfills.cjs';\n\nimport { createMatcher, transformSync } from 'ts-swc-transform';\n\nimport extensions from '../extensions.mjs';\nimport Cache from '../lib/Cache.mjs';\nimport loadTSConfig from '../lib/loadTSConfig.mjs';\n\nconst cache = new Cache();\nconst config = loadTSConfig(process.cwd());\nconfig.config.compilerOptions.module = 'CommonJS';\nconfig.config.compilerOptions.target = 'ES5';\nconst match = createMatcher(config);\n\nconst typeFileRegEx = /^[^.]+\\.d\\.(.*)$/;\n\nexport function register(options, hookOpts) {\n  options = options || {};\n  return pirates.addHook((code, filePath) => compile(code, filePath, options), Object.assign({ exts: extensions }, hookOpts || {}));\n}\n\nexport function compile(contents, filePath) {\n  const ext = path.extname(filePath);\n\n  // filter\n  if (!match(filePath)) return contents || ' ';\n  if (typeFileRegEx.test(filePath)) return ' ';\n  if (extensions.indexOf(ext) < 0) return contents || ' ';\n\n  const data = cache.getOrUpdate(cache.cachePath(filePath, config), contents, () => transformSync(contents, filePath, config));\n  return data.code;\n}\n"],"names":["path","pirates","createMatcher","transformSync","extensions","Cache","loadTSConfig","cache","config","process","cwd","compilerOptions","module","target","match","typeFileRegEx","register","options","hookOpts","addHook","code","filePath","compile","Object","assign","exts","contents","ext","extname","test","indexOf","data","getOrUpdate","cachePath"],"mappings":"AAAA,OAAOA,UAAU,OAAO;AACxB,OAAOC,aAAa,UAAU;AAC9B,OAAO,mBAAmB;AAE1B,SAASC,aAAa,EAAEC,aAAa,QAAQ,mBAAmB;AAEhE,OAAOC,gBAAgB,oBAAoB;AAC3C,OAAOC,WAAW,mBAAmB;AACrC,OAAOC,kBAAkB,0BAA0B;AAEnD,MAAMC,QAAQ,IAAIF;AAClB,MAAMG,SAASF,aAAaG,QAAQC,GAAG;AACvCF,OAAOA,MAAM,CAACG,eAAe,CAACC,MAAM,GAAG;AACvCJ,OAAOA,MAAM,CAACG,eAAe,CAACE,MAAM,GAAG;AACvC,MAAMC,QAAQZ,cAAcM;AAE5B,MAAMO,gBAAgB;AAEtB,OAAO,SAASC,SAASC,OAAO,EAAEC,QAAQ;IACxCD,UAAUA,WAAW,CAAC;IACtB,OAAOhB,QAAQkB,OAAO,CAAC,CAACC,MAAMC,WAAaC,QAAQF,MAAMC,UAAUJ,UAAUM,OAAOC,MAAM,CAAC;QAAEC,MAAMrB;IAAW,GAAGc,YAAY,CAAC;AAChI;AAEA,OAAO,SAASI,QAAQI,QAAQ,EAAEL,QAAQ;IACxC,MAAMM,MAAM3B,KAAK4B,OAAO,CAACP;IAEzB,SAAS;IACT,IAAI,CAACP,MAAMO,WAAW,OAAOK,YAAY;IACzC,IAAIX,cAAcc,IAAI,CAACR,WAAW,OAAO;IACzC,IAAIjB,WAAW0B,OAAO,CAACH,OAAO,GAAG,OAAOD,YAAY;IAEpD,MAAMK,OAAOxB,MAAMyB,WAAW,CAACzB,MAAM0B,SAAS,CAACZ,UAAUb,SAASkB,UAAU,IAAMvB,cAAcuB,UAAUL,UAAUb;IACpH,OAAOuB,KAAKX,IAAI;AAClB"}