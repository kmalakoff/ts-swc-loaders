{"version":3,"sources":["packageType.mjs"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\n\nconst packageJSONCache = new Map();\nfunction readPackageJson(packagePath) {\n  const existing = packageJSONCache.get(packagePath);\n  if (existing !== undefined) return existing;\n\n  try {\n    const packageJson = JSON.parse(fs.readFileSync(packagePath, 'utf8'));\n    packageJSONCache.set(packagePath, packageJson);\n    return packageJson;\n  } catch (_err) {\n    packageJSONCache.set(packagePath, null);\n    return null;\n  }\n}\n\nfunction getPackageScopeConfig(filePath) {\n  let packageDir = filePath;\n  while (packageDir) {\n    if (packageDir.endsWith('node_modules')) break;\n    const packageConfig = readPackageJson(path.join(packageDir, 'package.json'));\n    if (packageConfig) return packageConfig;\n\n    const prev = packageDir;\n    packageDir = path.dirname(packageDir);\n    if (packageDir === '' || packageDir === prev) break;\n  }\n  return {};\n}\n\nexport default function packageType(filePath) {\n  const pkg = getPackageScopeConfig(filePath);\n  return pkg.type || 'commonjs';\n}\n"],"names":["fs","path","packageJSONCache","Map","readPackageJson","packagePath","existing","get","undefined","packageJson","JSON","parse","readFileSync","set","_err","getPackageScopeConfig","filePath","packageDir","endsWith","packageConfig","join","prev","dirname","packageType","pkg","type"],"mappings":"AAAA,OAAOA,QAAQ,KAAK;AACpB,OAAOC,UAAU,OAAO;AAExB,MAAMC,mBAAmB,IAAIC;AAC7B,SAASC,gBAAgBC,WAAW;IAClC,MAAMC,WAAWJ,iBAAiBK,GAAG,CAACF;IACtC,IAAIC,aAAaE,WAAW,OAAOF;IAEnC,IAAI;QACF,MAAMG,cAAcC,KAAKC,KAAK,CAACX,GAAGY,YAAY,CAACP,aAAa;QAC5DH,iBAAiBW,GAAG,CAACR,aAAaI;QAClC,OAAOA;IACT,EAAE,OAAOK,MAAM;QACbZ,iBAAiBW,GAAG,CAACR,aAAa;QAClC,OAAO;IACT;AACF;AAEA,SAASU,sBAAsBC,QAAQ;IACrC,IAAIC,aAAaD;IACjB,MAAOC,WAAY;QACjB,IAAIA,WAAWC,QAAQ,CAAC,iBAAiB;QACzC,MAAMC,gBAAgBf,gBAAgBH,KAAKmB,IAAI,CAACH,YAAY;QAC5D,IAAIE,eAAe,OAAOA;QAE1B,MAAME,OAAOJ;QACbA,aAAahB,KAAKqB,OAAO,CAACL;QAC1B,IAAIA,eAAe,MAAMA,eAAeI,MAAM;IAChD;IACA,OAAO,CAAC;AACV;AAEA,eAAe,SAASE,YAAYP,QAAQ;IAC1C,MAAMQ,MAAMT,sBAAsBC;IAClC,OAAOQ,IAAIC,IAAI,IAAI;AACrB"}