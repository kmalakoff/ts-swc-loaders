{"version":3,"sources":["packageType.mjs"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport { URL, fileURLToPath, pathToFileURL } from 'url';\n\nconst packageJSONCache = new Map();\nfunction readPackageJson(path) {\n  const existing = packageJSONCache.get(path);\n  if (existing !== undefined) return existing;\n\n  try {\n    const packageJson = JSON.parse(fs.readFileSync(path, 'utf8'));\n    packageJSONCache.set(path, packageJson);\n    return packageJson;\n  } catch (_err) {\n    packageJSONCache.set(path, null);\n    return null;\n  }\n}\n\n// https://github.com/nodejs/node/blob/main/lib/internal/modules/esm/package_config.js#L103\nfunction getPackageScopeConfig(resolved) {\n  let packageJSONUrl = new URL('./package.json', resolved);\n  while (packageJSONUrl) {\n    const packageJSONPath = packageJSONUrl.pathname;\n    if (packageJSONPath.endsWith('node_modules/package.json')) {\n      break;\n    }\n    const packageConfig = readPackageJson(fileURLToPath(packageJSONUrl));\n    if (packageConfig) return packageConfig;\n\n    const lastPackageJSONUrl = packageJSONUrl;\n    packageJSONUrl = new URL('../package.json', packageJSONUrl);\n\n    // Terminates at root where ../package.json equals ../../package.json\n    // (can't just check \"/package.json\" for Windows support).\n    if (packageJSONUrl.pathname === lastPackageJSONUrl.pathname) break;\n  }\n  return {};\n}\n\nexport default function packageType(url) {\n  if (path.isAbsolute(url)) url = pathToFileURL(url); // windows\n\n  const pkg = getPackageScopeConfig(url);\n  return pkg.type || 'commonjs';\n}\n"],"names":["fs","path","URL","fileURLToPath","pathToFileURL","packageJSONCache","Map","readPackageJson","existing","get","undefined","packageJson","JSON","parse","readFileSync","set","_err","getPackageScopeConfig","resolved","packageJSONUrl","packageJSONPath","pathname","endsWith","packageConfig","lastPackageJSONUrl","packageType","url","isAbsolute","pkg","type"],"mappings":"AAAA,OAAOA,QAAQ,KAAK;AACpB,OAAOC,UAAU,OAAO;AACxB,SAASC,GAAG,EAAEC,aAAa,EAAEC,aAAa,QAAQ,MAAM;AAExD,MAAMC,mBAAmB,IAAIC;AAC7B,SAASC,gBAAgBN,IAAI;IAC3B,MAAMO,WAAWH,iBAAiBI,GAAG,CAACR;IACtC,IAAIO,aAAaE,WAAW,OAAOF;IAEnC,IAAI;QACF,MAAMG,cAAcC,KAAKC,KAAK,CAACb,GAAGc,YAAY,CAACb,MAAM;QACrDI,iBAAiBU,GAAG,CAACd,MAAMU;QAC3B,OAAOA;IACT,EAAE,OAAOK,MAAM;QACbX,iBAAiBU,GAAG,CAACd,MAAM;QAC3B,OAAO;IACT;AACF;AAEA,2FAA2F;AAC3F,SAASgB,sBAAsBC,QAAQ;IACrC,IAAIC,iBAAiB,IAAIjB,IAAI,kBAAkBgB;IAC/C,MAAOC,eAAgB;QACrB,MAAMC,kBAAkBD,eAAeE,QAAQ;QAC/C,IAAID,gBAAgBE,QAAQ,CAAC,8BAA8B;YACzD;QACF;QACA,MAAMC,gBAAgBhB,gBAAgBJ,cAAcgB;QACpD,IAAII,eAAe,OAAOA;QAE1B,MAAMC,qBAAqBL;QAC3BA,iBAAiB,IAAIjB,IAAI,mBAAmBiB;QAE5C,qEAAqE;QACrE,0DAA0D;QAC1D,IAAIA,eAAeE,QAAQ,KAAKG,mBAAmBH,QAAQ,EAAE;IAC/D;IACA,OAAO,CAAC;AACV;AAEA,eAAe,SAASI,YAAYC,GAAG;IACrC,IAAIzB,KAAK0B,UAAU,CAACD,MAAMA,MAAMtB,cAAcsB,MAAM,UAAU;IAE9D,MAAME,MAAMX,sBAAsBS;IAClC,OAAOE,IAAIC,IAAI,IAAI;AACrB"}